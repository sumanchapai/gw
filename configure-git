#!/bin/sh
set -e  # Exit immediately on any error

echo "[startup] Beginning container initialization..."

# -------------------------------------------------------------------
# Environment variables expected:
# -------------------------------------------------------------------
# GIT_USER_EMAIL     → email for git commits
# GIT_USER_NAME      → name for git commits
# GITHUB_USERNAME    → your GitHub username
# GITHUB_REPO        → repo name (e.g. "ui")
# GITHUB_REPO_TOKEN  → personal access token (PAT)
# -------------------------------------------------------------------

# --- Setup git config for commits ---
if [ -n "$GIT_USER_EMAIL" ] && [ -n "$GIT_USER_NAME" ]; then
  git config --global user.email "$GIT_USER_EMAIL"
  git config --global user.name "$GIT_USER_NAME"
  echo "[startup] Git user configured: $GIT_USER_NAME <$GIT_USER_EMAIL>"
else
  echo "[startup] Warning: Git user info not set — commits may fail."
fi

# Initialize /data as a git repo if not already part of one
if [ -d /data ]; then
  cd /data || exit 1
  if git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
    echo "/data is already inside a Git repository"
  else
    git init -b main
    echo "Initialized new Git repository with main branch at /data"
  fi
else
  echo "/data directory does not exist"
fi
